# **chap2:词典词项及倒排记录表**

**chap1讲的是建立倒排索引,chap2则是讲==前一步的建立词项词典以及如何实现倒排记录表==**

(其中最重要的前半部分的归一化以及后半部分的实现倒排记录)

>   **即预处理+具体实现倒排记录表的方式**
>
>   预处理:文档集->文本词条化->语言学预处理->建立索引
>
>   实现倒排记录表:快速合并算法(跳表),包含位置信息的倒排记录表,短语查询

主要流程:文档分析+[tokenizer]+==[Linguistic Module]==+[indexer]

**词典词项的建立**

(文档解析->词条化->停用词->(词项归一化词形归并->词干还原))

## **1.文档解析**

###### **0.文档解析的结果(目的):获取字符序列**

###### **1.需要解析的内容**

**格式:解析文档格式/文档语言/文档编码方式**

**多语言:文档存在多语言/文档存在不同格式嵌套/文档的索引粒度导致的差异**

**编码方式:ASCII/UNICODE(UTF)/Email的二进制编码**

###### **2.文档解析的方式**

**1.(if数字文档)判断编码类型:启发式 将字节序列转换为线性的字符序列**

**2.(if其它文档)判断文档格式:进行额外转化**

###### **3.文档单位(索引粒度)确定**

**常见索引粒度:(文章)->段落->句子->短语->单词/词项->(字母)..**

>   **如果索引粒度过大,段落更长:找到更多不相关的内容(可能噪声)<font color=red>(正确率低召回率高)</font>**
>
>   >   比如找'cardio'->'cardiovascular'/'cardiology'/...
>   >
>   >   (比如返回了一个章节.虽然很容易命中用户的需求,但是信息密度很低,要读很多无关内容)
>
>   **如果索引粒度过小,段落更短:错过更多重要的段落(索引长度变短)<font color=red>(正确率高召回率低)</font>**
>
>   >   比如找'cardio'->'car'/'card'/...
>   >
>   >   (比如返回了一个句子,虽然很难保证用户的需求,但是信息密度高,只需要读需要的部分)

**索引粒度确定的解决方案:常见于XML检索**

>   **多粒度索引/混合索引(混合结果)**

## **2.词条化(Tokenization)**

**词条化:定义好文档单位以后,将给定字符序列分成一系列序列的过程**

>   **Input:"Friends, Romans and Countrymen"**
>
>   **Output: ['Friends','Romans','and','Countrymen']**
>
>   词条(Tokens):在文档中出现的字符序列的一个实例。
>
>   词条类(Type)：相同词条构成的集合
>
>   词项(Terms):在信息检索系统词典中所包含的经过处理的词条类

**词条化存在的问题:大小写(被分为多个形式)/连字符(语义完整性被破坏)/空格(改变语义)**

## **3.停用词**

**停用词定义:在文档和用户需求进行匹配的时候没有价值,需要从词汇表中删除**

**停用词表:**

>   **将词项按照文档集频率，从高到底排列选取与文档意义不大同时高频出现的词**
>
>   **比如，`a, an, the, to, and, be`**

**停用词表优点:减少term的个数**

**停用词表缺点:有时候消除的停用词是有意义的**

## **4.词项归一化**

(词项归一化是所有归一化形式的总称,下面只不过是分步骤)

###### **0.词项归一化(文档和查询的归一化)**

**(合并相同语义)需要将文档和查询中的词条归一化成一致的形式,相同语义应该保证能够匹配**

>   同义词,近义词,词形变体(单复数,动词时态),时态语态...

###### **1.词条归一化(文档内容的归一化)**

**(合并相同term)将看似不一致的多个词条归一成一个等价类**

(U.S.A映射为USA,去掉连字符:比如anti-biotic->antibiotic)

###### **2.词形归并**

**(合并相词元)利用词汇表和词形分析去除词缀,转化为基本形式词元(lemma)**

(am,is,are->be;  car,cars,cars->car)

###### **3.词干还原**

**(去除前后缀):粗略的去除单词两端词缀的启发式过程**

(automate,automatic,automation->automat;中文AABB式->ABAB式)

###### **3.词项归一化和词条归一化的区别**

**没有区别,词项归一化其实是更加规范和完整的形式**

###### **4.归一化方式**

>   **a.隐式的建立等价类**
>
>   **b.手工建立同义词表**

###### **5.词条归一化标准**

>   **<font color=red>a.Porter标准(考试会考)</font>:大写转换成小写,去掉引号(不需要词干还原)**
>
>   **b.其它标准:按照发音/按照词根/不同语言间的差异**

****

**实现倒排记录表**

## **1.快速合并算法**

###### **0.基于双指针的合并算法**

**时间复杂度O(m+n),合并操作和线性表的总数成线性关系**

###### **1.基于跳表的合并算法**

**基本主要思想:如果满足条件则跳,快速到达归并区域,不满足条件则遍历搜素**

**多级思想:如果上方当前的指针所指对象大于下一层,则转到下一层遍历**

###### **2.跳表指针位置**

**使用$\sqrt{L} $作为间隔设置跳表指针/自定义跳表指针**

## **2.倒排记录的短语查询**

###### **0.背景**

**人们需要通过输入短语(将多个词项看作整体)得到一个查询**

###### **1.(解决方法)二元词索引**

**对于输入的句子(短语),前后组合成子连续词,对多个子连续词合并查询**

###### **2.(进一步的)扩展的二元词索引**

**对文本进行词条化,然后进行词性标注(加上掩码表示名词和虚词)**

###### **3.(解决方法)位置信息索引**

**`文档:pos1,pos2,...,posn`**

###### **4.(解决方法)k-gram临近搜索**

**/k表示从左边或右边相距在k个词之内**

## **课上题目**

###### **1.带有位置的倒排索引查询**

| 词项   | 文档2: (位置1, 位置2, …) | 文档4: (位置1, 位置2, …) | 文档7: (位置1, 位置2, …) |
| :----- | :----------------------- | :----------------------- | :----------------------- |
| angels | (36,174,252,651)         | (12,22,102,432)          | (17)                     |
| fools  | (1,17,74,222)            | (8,78,108,458)           | (3,13,23,193)            |
| fear   | (87,704,722,901)         | (13,43,113,433)          | (18,328,528)             |
| in     | (3,37,76,444,851)        | (10,20,110,470,500)      | (5,15,25,195)            |
| rush   | (2,66,194,321,702)       | (9,69,149,429,569)       | (4,14,404)               |
| to     | (47,86,234,999)          | (14,24,774,944)          | (199,319,599,709)        |
| tread  | (57,94,333)              | (15,35,155)              | (20,320)                 |
| where  | (67,124,393,1001)        | (11,41,101,421,431)      | (16,36,736)              |

**1.`fools rush in`->doc2,doc4,doc7**

**2.`fools rush in`AND`angels fear to tread`->只有doc4两句话都有**

## **Homework**

**2-2 归一化**

>   a.'Cos     ->  cos
>
>   b.Shi'ite  ->  shiite 
>
>   c.cont'd   ->  contd
>
>   d.Hawai'i  ->  hawaii
>
>   e.O'Rourke ->  orourke

**2-3 词干还原**

>   a.abandon/abandonment -> abandon
>
>   b.absorbency/absorbent -> absorb
>
>   c.maketing/markets    -> <font color=red>意思不同不应该合并</font>
>
>   d.university/universe -> <font color=red>意思不同不应该合并</font>
>
>   e.volume/volumes      -> volume

**2-4 词干还原**

>   circus canaries boss  -> circus canari boss

**2-6 跳表比较次数**

>   **word1:[<font color=red>4</font>,6,10,12,<font color=red>14</font>,16,18,20,<font color=red>22</font>,32,47,81,<font color=red>120</font>,122,157,180]**
>
>   **word2:[47]**
>
>   >   **a.使用标准倒排记录表**
>   >
>   >   比较11次(4,6,10,12,14,16,18,20,22,32,47)
>   >
>   >   **b.使用跳表$\sqrt{n}=4 $**
>   >
>   >   比较6次(4,14,22,120,22,32,(47))

**2-7 跳表合并的实际跳转次数(题目规定的跳表)**

list1:<font color=red>3</font> 5 9 15 <font color=red>24</font> 39 60 68 <font color=red>75</font> 81 84 89 <font color=red>92</font> 96 97 100 <font color=red>115</font>

list2:3 5 89 95 97 99 100 101

表示跳转成功多少次(而不是比较的次数):只有1次,24到75

合并时比较的次数18次

|  1   |       3        | 2        |
| :--: | :------------: | -------- |
|  2   |       5        | 5        |
|  3   |       9        | 89       |
|  4   |       15       | 89       |
|  5   |       24       | 89       |
|  6   | 跳表算一次比较 | 89       |
|  7   |       75       | 89       |
|  8   |       81       | 89       |
|  9   |       84       | 89       |
|  10  |       89       | 89       |
|  11  |       92       | 95       |
|  12  |       96       | 95       |
|  13  |       96       | 97       |
|  14  |       97       | 97       |
|  15  |      100       | 99       |
|  16  |      100       | 100      |
|  17  |      115       | 101      |
|  18  |      115       | 直接加入 |

都不使用跳表19次



